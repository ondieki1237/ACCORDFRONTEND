(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[327],{4173:function(e,t,s){Promise.resolve().then(s.bind(s,4180)),Promise.resolve().then(s.bind(s,1523)),Promise.resolve().then(s.bind(s,49))},4180:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(7437),r=s(2265),n=s(2679),l=s(755),i=s(3479),c=s(5013),o=s(8369),d=s(4949),h=s(759),x=s.n(h);s(5046),s(2827);var m=s(3774),u=s(4401),p=s(7168),g=s(8289);let f=new(x()).DivIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="#d32f2f">\n    <circle cx="12" cy="12" r="12" fill="white" stroke="#d32f2f" stroke-width="2"/>\n    <path d="M13 11h4v2h-4v4h-2v-4H7v-2h4V7h2v4z"/>\n  </svg>',className:"",iconSize:[28,28],iconAnchor:[14,28],popupAnchor:[0,-28]});function b(){let[e,t]=(0,r.useState)(null);return(0,r.useEffect)(()=>{fetch("/hospitals.json").then(e=>e.json()).then(e=>t(e)).catch(e=>console.error("Error loading hospital data:",e))},[]),e?(0,a.jsx)(g.Q,{data:e,pointToLayer:(e,t)=>x().marker(t,{icon:f}),onEachFeature:(e,t)=>{var s,a,r;let n=(null===(s=e.properties)||void 0===s?void 0:s.name)||"Unnamed Facility",l=(null===(a=e.properties)||void 0===a?void 0:a.amenity)||"Health Facility",i=(null===(r=e.properties)||void 0===r?void 0:r.operator)||"Unknown";t.bindPopup("\n          <div>\n            <strong>".concat(n,"</strong><br/>\n            Type: ").concat(l,"<br/>\n            Operator: ").concat(i,"\n          </div>\n        "))}}):null}function v(e){let t=0;for(let s=1;s<e.length;s++)t+=function(e,t,s,a){let r=(s-e)*Math.PI/180,n=(a-t)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371}(e[s-1].lat,e[s-1].lng,e[s].lat,e[s].lng);return t}let j=["#2563eb","#10b981","#f59e42","#ef4444","#a21caf","#f43f5e","#0ea5e9","#eab308"],y=e=>{let{data:t}=e,s=(0,n.Sx)();return(0,r.useEffect)(()=>{if(s.heatLayer&&s.removeLayer(s.heatLayer),t.length>0){let e=t.map(e=>[e.lat,e.lng,e.intensity]),a=x().heatLayer(e,{radius:25,blur:15,maxZoom:12,gradient:{0:"#3B82F6",.2:"#10B981",.4:"#F59E0B",.6:"#EF4444",.8:"#DC2626",1:"#991B1B"}});a.addTo(s),s.heatLayer=a}return()=>{s.heatLayer&&(s.removeLayer(s.heatLayer),s.heatLayer=void 0)}},[t,s]),null};var N=()=>{let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(null),h=e.map(e=>e.user),g=s?e.filter(e=>e.user.id===s):e,[f,N]=(0,r.useState)(!0),[w,I]=(0,r.useState)(null),[M,k]=(0,r.useState)(null),[E,L]=(0,r.useState)(!0),[S,z]=(0,r.useState)(!0),T=(0,r.useRef)(null),F=async()=>{try{I(null);let e=await fetch("https://accordbackend.onrender.com/api/dashboard/heatmap/live",{headers:{Authorization:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4YzE4ODIxOWI4ZmVmOTAxNjQwMTJhOCIsImlhdCI6MTc1NzgyNTYzMywiZXhwIjoxNzU4NDMwNDMzfQ.SfDFRZOclIkmuLLcx1Sa2JjT8vIyaoMI86H0rOdCIoQ"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json();if(s.success)t(s.data),k(new Date);else throw Error("API returned unsuccessful response")}catch(e){I(e instanceof Error?e.message:"Failed to fetch heatmap data"),console.error("Error fetching heatmap data:",e)}finally{N(!1)}};(0,r.useEffect)(()=>{F()},[]),(0,r.useEffect)(()=>(E?T.current=setInterval(F,3e4):T.current&&clearInterval(T.current),()=>{T.current&&clearInterval(T.current)}),[E]);let O=new(x()).Icon({iconUrl:"https://cdn-icons-png.flaticon.com/512/684/684908.png",iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-28]});return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex",children:[(0,a.jsxs)("aside",{className:"w-80 bg-white border-r border-gray-200 p-4 flex flex-col gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Active Trails"}),(0,a.jsx)("ul",{className:"space-y-2 max-h-48 overflow-y-auto",children:h.map(t=>{var s;let r=e.find(e=>e.user.id===t.id),n=r?v(r.path):0;return(0,a.jsxs)("li",{className:"flex flex-col mb-2",children:[(0,a.jsx)("span",{className:"font-medium text-blue-700",children:t.name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["ID: ",t.employeeId," | Region: ",t.region]}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:[null!==(s=null==r?void 0:r.path.length)&&void 0!==s?s:0," pts | ",n.toFixed(2)," km"]})]},t.id)})})]}),(0,a.jsxs)("div",{className:"mt-4 text-sm font-semibold text-blue-900",children:["Total Distance: ",e.reduce((e,t)=>e+v(t.path),0).toFixed(2)," km"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"user-select",className:"block text-sm font-medium mb-1",children:"Show Trail for:"}),(0,a.jsxs)("select",{id:"user-select",className:"w-full border rounded px-2 py-1",value:s||"",onChange:e=>n(e.target.value||null),children:[(0,a.jsx)("option",{value:"",children:"All Trails"}),h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-md font-semibold mb-1",children:"Points"}),(0,a.jsx)("ul",{className:"text-xs max-h-40 overflow-y-auto",children:g.map(e=>e.path.map((t,s)=>(0,a.jsxs)("li",{className:"mb-1",children:[(0,a.jsxs)("span",{className:"font-mono",children:["[",t.lat,", ",t.lng,"]"]}),(0,a.jsxs)("span",{className:"ml-2 text-gray-400",children:["(",e.user.name,")"]})]},e.user.id+"-"+s)))})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("button",{onClick:()=>z(e=>!e),className:"w-full mt-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors border ".concat(S?"bg-red-100 text-red-700 border-red-200 hover:bg-red-200":"bg-gray-100 text-gray-700 border-gray-200 hover:bg-gray-200"),children:[S?"Hide":"Show"," Hospital Locations"]})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"bg-blue-500 p-2 rounded-lg",children:(0,a.jsx)(m.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Person Heatmap"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Live tracking of field sales activities in Kenya"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"bg-gray-50 px-4 py-2 rounded-lg flex items-center space-x-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-blue-500"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[e.reduce((e,t)=>e+t.path.length,0)," Active Points"]})]}),M&&(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Last updated: ",M.toLocaleTimeString()]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>{L(!E)},className:"px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(E?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:["Auto: ",E?"ON":"OFF"]}),(0,a.jsxs)("button",{onClick:()=>{N(!0),F()},disabled:f,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 ".concat(f?"animate-spin":"")}),(0,a.jsx)("span",{children:"Refresh"})]})]})]})]}),(0,a.jsxs)("div",{className:"relative h-[calc(100vh-100px)]",children:[w&&(0,a.jsxs)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-[1000] bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg",children:[(0,a.jsx)("span",{className:"font-medium",children:"Error:"})," ",w]}),f&&(0,a.jsxs)("div",{className:"absolute top-4 right-4 z-[1000] bg-white px-4 py-2 rounded-lg shadow-lg flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4 animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Loading data..."})]}),(0,a.jsxs)(l.h,{center:[-1.286389,36.817223],zoom:7,className:"h-full w-full",children:[(0,a.jsx)(i.I,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),S&&(0,a.jsx)(b,{}),(0,a.jsx)(y,{data:e.flatMap(e=>e.path.map(e=>({lat:e.lat,lng:e.lng,intensity:1})))}),(s?e.filter(e=>e.user.id===s):e).map(e=>{let t=j[h.findIndex(t=>t.id===e.user.id)%j.length];return(0,a.jsxs)(r.Fragment,{children:[e.path.map((s,r)=>{if(r<e.path.length-1){let n=e.path[r+1];return(0,a.jsx)(c.a,{positions:[[s.lng,s.lat],[n.lng,n.lat]],pathOptions:{color:t,weight:3,opacity:.7}},"".concat(e.user.id,"-seg-").concat(r))}return null}),e.path.map((t,s)=>(0,a.jsx)(o.J,{position:[t.lat,t.lng],icon:O,children:(0,a.jsx)(d.G,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:e.user.name}),(0,a.jsx)("br",{}),"Employee ID: ",e.user.employeeId,(0,a.jsx)("br",{}),"Region: ",e.user.region,(0,a.jsx)("br",{}),"Point #",s+1,": [",t.lat,", ",t.lng,"]"]})})},"".concat(e.user.id,"-pt-").concat(s)))]},e.user.id)})]}),(0,a.jsxs)("div",{className:"absolute bottom-4 left-4 bg-white p-4 rounded-lg shadow-lg z-[1000]",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Activity Intensity"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Low"}),(0,a.jsx)("div",{className:"w-20 h-3 rounded-full bg-gradient-to-r from-blue-500 via-green-500 via-yellow-500 to-red-600"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"High"})]})]})]})]})]})}}},function(e){e.O(0,[641,212,439,971,117,744],function(){return e(e.s=4173)}),_N_E=e.O()}]);